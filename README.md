# Image Editor 

Emscripten compiles C++ functions into WASM, which is then called by JS. 

### Emscripten 

Emscripten is an open-source compiler toolchain that allows you to compile C and C++ code into WASM, so it can run effectively in web browser. 

Run the following in the command line: 

`emcc image_processor.cpp \
  -o image_processor.js \
  -s MODULARIZE=1 \
  -s 'EXPORT_NAME="Module"' \
  -s EXPORTED_FUNCTIONS='["_monochrome_average", "_monochrome_luminosity", "_monochrome_lightness", "_monochrome_itu", "_gaussian_blur", "_edge_sobel", "_edge_laplacian_of_gaussian", "_data_to_layer", "_malloc", "_free"]' \
  -s EXPORTED_RUNTIME_METHODS='["ccall", "cwrap", "HEAPU8"]' \
  -s ALLOW_MEMORY_GROWTH=1 \
  -O2` 

It compiles the C++ file and outputs `image_processor.wasm` (the compiled WASM) and `image_processor.js` (the JS wrapper). `_malloc` and `_free` allows JS to allocate and free memory in WASM. `HEAPU8` is used by JS to access raw WASM memory as a Uint8Array. Memory growth in WASM is allowed if needed (such as for large images). 

### Extern C 

`extern "C"` is a directive in C++ that tells the compiler to use C-style naming for functions so they can be called from other languages. C++ mangles function names (adds extra info like parameter types) to support function overloading. This makes the compiler names unreadable or inconsistent for other languages. 

### RGBA 

RGB are the colours red, green, and blue respectively, each in the range 0 - 255. Alpha is the opacity/transparency, also in the range 0 - 255. 

### `Module()` 

Module() is a function generated by Emscripten when compiling C++ to WASM with MODULARIZE=1. It loads the WASM module asynchronously then assigns it to the wasmModule so you can call exported C++ functions. 

### `ccall` and `cwrap` 

Both `ccall` and `cwrap` are provided by Emscripten to call C/C++ functions from JS. 

Key differences: 
- `ccall` calls function immediately, while `cwrap` returns a callable JS function. 
- Use `ccall` for one-off calls, use `cwrap` for repeated calls / better performance. 

# Current features 

## Upload file 

Select image file to upload to browser. 

## Monochromatic filters 

Implement various types, including the average method, the luminosity method, the lightness method, ITU-R BT.709 recommendations for modern digital media (such as YouTube, HDTV, or FFmpeg). 
- The average method is simple but does not reflect human visual perception as it treats all colours equally. `gray = (R + G + B) / 3`
- The luminosity method is the common standard, gives best visual quality and realism. Slightly slower to calculate does to floating point math. `gray = 0.299 * R + 0.587 * G + 0.114 * B` 
- The lightness method keeps the contrast between the brightest and darkest parts, but ignores mid-tone details. `gray = (max(R,G,B) + min(R, G, B)) / 2`
- The ITU-R BT.709 reflects the modern expectations for grayscale conversion. `gray = 0.2126 * R + 0.7152 * G + 0.0722 * B`

## Blurring 

Gaussian blur uses the Gaussian function to soften an image by smoothing pixel values. It is used to reduce noise, reduce details, and to creata a smooth effect. 
- The kernel size determines how many pixels are sampled around each pixel. A larger kernel can capture more of the Gaussian curve, producing a better approximation of the blur. 
- The standard deviation (sigma) controls the strength of the blur. A larger sigma spreads out the weights more, causing a smoother and wider blur. 

## Edge detection 

The Sobel method is a gradient-based edge detection method that computes gradient magnitudes in both x and y directions using 3x3 convolution kernels, good for emphasizing edges and reducing noise. 

The Laplacian of Gaussian (LoG) method is a second derivative-based method that applies the Gaussian blur, then the Laplacian operator to detect edges at points of rapid intensity change. 

# Additional functionalities and TODOs 

## Edge detection 

The Canny edge detector is the standard for many applications. 
1. Apply Gaussian blur (noise reduction). 
2. Compute gradients (Sobel). 
3. Non-maximum suppression (thin edges). 
4. Hysteresis thresholding (track strong/weak edges). 
This method is accurate, clean, and efficient. 

## Colour fill (paint bucket) 

Users are able to select a desired colour (RGBA, hex, or colour wheel), input an error threshold (between 0 and 1), and click the image to fill the area with the input threshold. 

The error bound e between 0 and 1 indicates how "different" a pixel to be filled can be compared to the colour of the pixel selected. Let R be the reference (selected) pixel, and let T be the pixel that we are trying to determine if it should be filled or not. For T to be filled, it must satisfy ...TODO 

## Image compression 

## Image decompression 

## Undo 

## Redo 

## Revert to original image 

## Image blending 


## TODO 

- Explain the sigma and kernel for Gaussian Blur 
- Update README with demos of each filter 
- CSS styling and design 
- Use SIMD instructions for WASM 
- Consider passing C++ objects instead of pointer to raw data 
- Check LinkedIn job application requirements 
- Check Figma 
- Design using Figma 
- Open CV library 

Links to consider 

Upscaling image by converting from raster to vector 
https://en.wikipedia.org/wiki/Image_tracing 

https://www.figma.com/blog/webassembly-cut-figmas-load-time-by-3x/ 
https://www.figma.com/blog/speeding-up-build-times/ 


# Known bugs
